@startuml

left to right direction

skinparam usecase {
  BackgroundColor #F4F7F9
  BorderColor #2B6CB0
}

actor "Docente" as Docente
actor "Auxiliar\n(Personal IE)" as Auxiliar
actor "Apoderado\n(Padres/Tutores)" as Apoderado
actor "Administrador\n(Personal Admin)" as Admin

rectangle "Módulo Justificaciones y Retiros\n(gestión de inasistencias y retiros anticipados)" {

  ' Autenticación
  usecase UC_Login as "Autenticarse / Iniciar sesión\n(JWT, roles, permisos)"

  ' Justificaciones
  usecase UC_JustificarInasistencia as "Justificar inasistencias\n(formulario, tipos, rangos de fecha)"
  usecase UC_SubirDocumentos as "Subir documentos respaldo\n(PDF, imágenes)"
  usecase UC_RevisarJustificaciones as "Revisar justificaciones\n(aprobar/rechazar)"
  usecase UC_AplicarJustificaciones as "Aplicar justificaciones\n(actualizar asistencias)"

  ' Retiros
  usecase UC_SolicitarRetiro as "Solicitar retiro estudiante\n(formulario, validaciones)"
  usecase UC_AprobarRetiro as "Aprobar/Rechazar retiro\n(apoderado titular)"
  usecase UC_EjecutarRetiro as "Ejecutar retiro presencial\n(verificación identidad)"
  usecase UC_ConsultarRetiros as "Consultar estado retiros\n(historial, seguimiento)"

  ' Notificación
  usecase UC_EncolarNotificaciones as "Encolar notificaciones\n(retiros y justificaciones)"
}

' Relaciones actores - casos de uso
Apoderado --> UC_Login
Apoderado --> UC_JustificarInasistencia : "según necesidad"
Apoderado --> UC_SubirDocumentos : "adjuntar respaldo"
Apoderado --> UC_SolicitarRetiro : "0..N / mes"
Apoderado --> UC_AprobarRetiro : "si es titular"
Apoderado --> UC_ConsultarRetiros : "seguimiento solicitudes"

Docente --> UC_Login
Docente --> UC_RevisarJustificaciones : "según permisos"
Docente --> UC_EjecutarRetiro : "si acompaña retiro"
Docente --> UC_ConsultarRetiros : "estado de retiros de sus estudiantes"

Auxiliar --> UC_Login
Auxiliar --> UC_EjecutarRetiro : "retiros presenciales"
Auxiliar --> UC_ConsultarRetiros : "gestión retiros"
Auxiliar --> UC_RevisarJustificaciones : "revisión documentos" 

Admin --> UC_Login
Admin --> UC_RevisarJustificaciones
Admin --> UC_AplicarJustificaciones
Admin --> UC_ConsultarRetiros

' Relaciones include/extend
UC_JustificarInasistencia ..> UC_SubirDocumentos : <<include>>
UC_RevisarJustificaciones ..> UC_AplicarJustificaciones : <<include>>

UC_SolicitarRetiro ..> UC_AprobarRetiro : <<extend>>
UC_AprobarRetiro ..> UC_EjecutarRetiro : <<extend>>

UC_SolicitarRetiro ..> UC_EncolarNotificaciones : <<include>>
UC_AprobarRetiro ..> UC_EncolarNotificaciones : <<include>>
UC_EjecutarRetiro ..> UC_EncolarNotificaciones : <<include>>

note right of UC_JustificarInasistencia
  Flujo típico:
  1. Apoderado selecciona estudiante y fechas
  2. Indica tipo de justificación
  3. Adjunta documentos de respaldo
  4. Envía solicitud para revisión
end note

note bottom of UC_RevisarJustificaciones
  Criterios de revisión:
  - Consistencia con asistencia registrada
  - Validez de documentos
  - Límites de días permitidos
  - Historial del estudiante
end note

note bottom of UC_EjecutarRetiro
  Seguridad en retiros:
  - Verificación de identidad (DNI)
  - Validación de apoderado autorizado
  - Registro de hora de salida
  - Auditoría del proceso
end note

note right of UC_EncolarNotificaciones
  Notificaciones relacionadas:
  - Nueva solicitud de retiro
  - Retiro aprobado/rechazado
  - Retiro ejecutado
  - Justificación recibida
  - Justificación aprobada/rechazada
end note

@enduml
