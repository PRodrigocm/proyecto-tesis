@startuml

left to right direction

skinparam usecase {
  BackgroundColor #F4F7F9
  BorderColor #2B6CB0
}

actor "Docente" as Docente
actor "Auxiliar\n(Personal IE)" as Auxiliar
actor "Apoderado\n(Padres/Tutores)" as Apoderado
actor "Administrador\n(Personal Admin)" as Admin

rectangle "Módulo Asistencia con Código QR\n(IE y aulas, validación QR, estados automáticos)" {

  ' Autenticación
  usecase UC_Login as "Autenticarse / Iniciar sesión\n(JWT, roles, permisos)"

  ' Registro de asistencias con QR
  usecase UC_RegistrarAsistenciaIE as "Registrar entrada/salida IE (QR)\n(tolerancias, estados automáticos)"
  usecase UC_RegistrarAsistenciaAula as "Registrar asistencia en aula (QR)\n(por materia, horarios)"
  usecase UC_RegistrarAsistenciaTaller as "Registrar asistencia talleres (QR)\n(extracurriculares)"

  ' Lógica compartida
  usecase UC_ValidarQR as "Validar código QR\n(idempotencia, seguridad)"
  usecase UC_DeterminarEstado as "Determinar estado asistencia\n(PRESENTE/TARDANZA/AUSENTE)"

  ' Consultas y seguimiento
  usecase UC_ConsultarAsistencias as "Consultar historial asistencias\n(filtros, rangos de fecha)"
  usecase UC_GenerarReportes as "Generar reportes asistencias\n(por estudiante/grado/sección)"

  ' Gestión técnica
  usecase UC_GestionarCodigosQR as "Gestionar códigos QR\n(generar, renovar, invalidar)"
  usecase UC_ConfigurarSistema as "Configurar parámetros asistencia\n(tolerancias, umbrales, calendarios)"
}

' Relaciones actores - casos de uso
Docente --> UC_Login
Docente --> UC_RegistrarAsistenciaAula : "1..N / clase"
Docente --> UC_RegistrarAsistenciaTaller : "1..N / taller"
Docente --> UC_ConsultarAsistencias : "consulta estudiantes"

Auxiliar --> UC_Login
Auxiliar --> UC_RegistrarAsistenciaIE : "entrada/salida diaria"
Auxiliar --> UC_ConsultarAsistencias : "supervisión general"

Apoderado --> UC_Login
Apoderado --> UC_ConsultarAsistencias : "1..N / semana"

Admin --> UC_Login
Admin --> UC_GestionarCodigosQR
Admin --> UC_ConfigurarSistema
Admin --> UC_GenerarReportes

' Relaciones include/extend internas del módulo
UC_RegistrarAsistenciaIE ..> UC_ValidarQR : <<include>>
UC_RegistrarAsistenciaAula ..> UC_ValidarQR : <<include>>
UC_RegistrarAsistenciaTaller ..> UC_ValidarQR : <<include>>

UC_RegistrarAsistenciaIE ..> UC_DeterminarEstado : <<include>>
UC_RegistrarAsistenciaAula ..> UC_DeterminarEstado : <<include>>
UC_RegistrarAsistenciaTaller ..> UC_DeterminarEstado : <<include>>

UC_GenerarReportes ..> UC_ConsultarAsistencias : <<include>>

note right of UC_ValidarQR
  Validación QR:
  - Verificación formato
  - Idempotencia (evita duplicados)
  - Validación temporal (ventana de tiempo)
  - Seguridad anti-falsificación
  - Log de intentos
end note

note bottom of UC_DeterminarEstado
  Reglas de negocio para estados:
  - Comparación con horario de clase
  - Tolerancia en minutos
  - Estados: PRESENTE, TARDANZA, FALTA
  - Posible estado JUSTIFICADO
end note

note bottom of UC_GestionarCodigosQR
  Gestión centralizada de códigos QR:
  - Generación masiva por estudiante
  - Renovación periódica
  - Invalidación por pérdida/robo
  - Asociación con estudiante e IE
end note

@enduml
