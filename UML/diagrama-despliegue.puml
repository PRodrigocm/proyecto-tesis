@startuml
!theme plain
title Sistema de Gestión de Asistencias y Retiros - Diagrama de Despliegue

node "Cliente Web" as ClienteWeb {
  component [Navegador Web] as Browser
  component [React/Next.js App] as ReactApp
  
  Browser --> ReactApp : "Ejecuta"
}
node "Servidor de Aplicación" as AppServer {
  component [Next.js Server] as NextServer
  component [API Routes] as APIRoutes
  component [Middleware] as Middleware
  component [Business Logic] as BusinessLogic
  
  NextServer --> APIRoutes : "Maneja"
  APIRoutes --> Middleware : "Usa"
  APIRoutes --> BusinessLogic : "Ejecuta"
}

node "Servidor de Base de Datos" as DBServer {
  database [PostgreSQL] as PostgreDB
  component [Prisma ORM] as PrismaORM
  component [Connection Pool] as ConnPool
  
  PrismaORM --> PostgreDB : "Conecta"
  ConnPool --> PostgreDB : "Gestiona conexiones"
}

node "Servidor de Archivos" as FileServer {
  storage [File Storage] as FileStorage
  component [Upload Handler] as UploadHandler
  
  UploadHandler --> FileStorage : "Gestiona"
}

node "Servidor de Notificaciones" as NotifServer {
  component [Email Service] as EmailSvc
  component [SMS Gateway] as SMSGateway
  component [Notification Queue] as NotifQueue
  
  NotifQueue --> EmailSvc : "Procesa"
  NotifQueue --> SMSGateway : "Procesa"
}

cloud "Servicios Externos" as ExternalServices {
  component [Proveedor Email] as EmailProvider
  component [Proveedor SMS] as SMSProvider
  component [CDN] as CDN
}

' Conexiones de Red
ClienteWeb --> AppServer : "HTTPS/WSS"
AppServer --> DBServer : "TCP/5432"
AppServer --> FileServer : "HTTP/HTTPS"
AppServer --> NotifServer : "HTTP/Message Queue"
NotifServer --> ExternalServices : "HTTPS/API"

@enduml
