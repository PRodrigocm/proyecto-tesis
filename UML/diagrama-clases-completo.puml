@startuml Diagrama de Clases - Sistema de Asistencia Escolar

' Configuración
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam groupInheritance 2
hide circle
skinparam shadowing false

' ============================================
' MÓDULO: INSTITUCIÓN EDUCATIVA
' ============================================
package "Institución Educativa" {
  class Modalidad {
    +idModalidad: int
    +nombre: string
  }

  class Ie {
    +idIe: int
    +nombre: string
    +codigoIe: string
    +direccion: string
    +email: string
    +telefono: string
    +idModalidad: int
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class Nivel {
    +idNivel: int
    +idIe: int
    +nombre: string
  }

  class Grado {
    +idGrado: int
    +idNivel: int
    +nombre: string
  }

  class Seccion {
    +idSeccion: int
    +nombre: string
  }

  class GradoSeccion {
    +idGradoSeccion: int
    +idGrado: int
    +idSeccion: int
  }

  class CalendarioEscolar {
    +idCalendario: int
    +idIe: int
    +fechaInicio: DateTime
    +fechaFin: DateTime
    +tipoDia: string
    +descripcion: string
    +creadoEn: DateTime
  }
}

' ============================================
' MÓDULO: USUARIOS Y ROLES
' ============================================
package "Usuarios y Roles" {
  class Usuario {
    +idUsuario: int
    +nombre: string
    +apellido: string
    +dni: string
    +email: string
    +telefono: string
    +passwordHash: string
    +estado: string
    +idIe: int
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class Rol {
    +idRol: int
    +nombre: string
  }

  class UsuarioRol {
    +idUsuario: int
    +idRol: int
  }

  class Estudiante {
    +idEstudiante: int
    +idUsuario: int
    +idIe: int
    +idGradoSeccion: int
    +codigoQR: string
    +fechaNacimiento: DateTime
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class Apoderado {
    +idApoderado: int
    +idUsuario: int
    +codigo: string
    +ocupacion: string
    +direccion: string
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class Docente {
    +idDocente: int
    +idUsuario: int
    +codigo: string
    +especialidad: string
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class EstudianteApoderado {
    +idEstudiante: int
    +idApoderado: int
    +relacion: string
    +esTitular: boolean
    +puedeRetirar: boolean
  }
}

' ============================================
' MÓDULO: HORARIOS Y ASIGNACIONES
' ============================================
package "Horarios y Asignaciones" {
  class HorarioClase {
    +idHorarioClase: int
    +idGradoSeccion: int
    +idDocente: int
    +materia: string
    +diaSemana: int
    +horaInicio: DateTime
    +horaFin: DateTime
    +aula: string
    +activo: boolean
    +sesiones: int
    +tipoActividad: TipoActividadEnum
    +toleranciaMin: int
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class TipoAsignacion {
    +idTipoAsignacion: int
    +nombre: string
  }

  class DocenteAula {
    +idDocenteAula: int
    +idDocente: int
    +idGradoSeccion: int
    +idTipoAsignacion: int
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  enum TipoActividadEnum {
    CLASE_REGULAR
    REFORZAMIENTO
    RECUPERACION
    EVALUACION
  }
}

' ============================================
' MÓDULO: ASISTENCIAS
' ============================================
package "Asistencias" {
  class Asistencia {
    +idAsistencia: int
    +idEstudiante: int
    +idHorarioClase: int
    +fecha: DateTime
    +idEstadoAsistencia: int
    +horaRegistro: DateTime
    +registradoPor: int
    +observaciones: string
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class AsistenciaIE {
    +idAsistenciaIE: int
    +idEstudiante: int
    +idIe: int
    +fecha: DateTime
    +horaIngreso: DateTime
    +horaSalida: DateTime
    +estado: string
    +registradoIngresoPor: int
    +registradoSalidaPor: int
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class EstadoAsistencia {
    +idEstadoAsistencia: int
    +nombreEstado: string
    +activo: boolean
    +afectaAsistencia: boolean
    +codigo: string
    +requiereJustificacion: boolean
  }

  class HistoricoEstadoAsistencia {
    +idHistorico: int
    +idAsistencia: int
    +idEstadoAsistencia: int
    +fechaCambio: DateTime
    +cambiadoPor: int
  }
}

' ============================================
' MÓDULO: JUSTIFICACIONES
' ============================================
package "Justificaciones" {
  class Justificacion {
    +idJustificacion: int
    +idEstudiante: int
    +idIe: int
    +idTipoJustificacion: int
    +idEstadoJustificacion: int
    +idEstadoAsistencia: int
    +fechaInicio: DateTime
    +fechaFin: DateTime
    +motivo: string
    +observaciones: string
    +fechaPresentacion: DateTime
    +presentadoPor: int
    +revisadoPor: int
    +fechaRevision: DateTime
    +observacionesRevision: string
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class TipoJustificacion {
    +idTipoJustificacion: int
    +nombre: string
    +codigo: string
    +requiereDocumento: boolean
    +diasMaximos: int
    +activo: boolean
  }

  class EstadoJustificacion {
    +idEstadoJustificacion: int
    +nombre: string
    +codigo: string
    +esFinal: boolean
    +activo: boolean
  }

  class DocumentoJustificacion {
    +idDocumento: int
    +idJustificacion: int
    +nombreArchivo: string
    +rutaArchivo: string
    +tipoArchivo: string
    +tamanioBytes: int
    +descripcion: string
    +subidoPor: int
    +createdAt: DateTime
  }

  class AsistenciaJustificacion {
    +idAsistencia: int
    +idJustificacion: int
    +fechaAplicacion: DateTime
    +aplicadoPor: int
  }
}

' ============================================
' MÓDULO: RETIROS
' ============================================
package "Retiros" {
  class Retiro {
    +idRetiro: int
    +idEstudiante: int
    +idIe: int
    +idGradoSeccion: int
    +fecha: DateTime
    +hora: DateTime
    +idTipoRetiro: int
    +origen: string
    +reportadoPorDocente: int
    +apoderadoContactado: int
    +horaContacto: DateTime
    +medioContacto: string
    +apoderadoQueRetira: int
    +dniVerificado: string
    +verificadoPor: int
    +idEstadoRetiro: int
    +observaciones: string
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  class TipoRetiro {
    +idTipoRetiro: int
    +nombre: string
  }

  class EstadoRetiro {
    +idEstadoRetiro: int
    +codigo: string
    +nombre: string
    +orden: int
    +esFinal: boolean
    +createdAt: DateTime
  }

  class AutorizacionRetiro {
    +idAut: int
    +idEstudiante: int
    +idApoderado: int
    +vigenteDesde: DateTime
    +vigenteHasta: DateTime
    +observacion: string
  }
}

' ============================================
' MÓDULO: NOTIFICACIONES Y REUNIONES
' ============================================
package "Notificaciones y Reuniones" {
  class Notificacion {
    +idNotificacion: int
    +idUsuario: int
    +titulo: string
    +mensaje: string
    +tipo: string
    +leida: boolean
    +fechaEnvio: DateTime
    +fechaLectura: DateTime
    +origen: string
  }

  class Reunion {
    +idReunion: int
    +idIe: int
    +titulo: string
    +descripcion: string
    +fecha: DateTime
    +horaInicio: DateTime
    +horaFin: DateTime
    +tipo: TipoReunionEnum
    +createdAt: DateTime
    +updatedAt: DateTime
  }

  enum TipoReunionEnum {
    GENERAL
    ENTREGA_LIBRETAS
    ASAMBLEA_PADRES
    TUTORIAL
    EMERGENCIA
    OTRO
  }
}

' ============================================
' RELACIONES: INSTITUCIÓN EDUCATIVA
' ============================================
' Composición: IE contiene Niveles (si se elimina IE, se eliminan sus niveles)
Ie *-- Nivel
Ie *-- CalendarioEscolar

' Composición: Nivel contiene Grados
Nivel *-- Grado

' Agregación: GradoSeccion referencia Grado y Seccion (pueden existir independientemente)
Grado o-- GradoSeccion
Seccion o-- GradoSeccion

' Asociación: Modalidad clasifica IE
Modalidad -- Ie

' ============================================
' RELACIONES: USUARIOS
' ============================================
' Composición: Usuario contiene sus roles específicos (si se elimina usuario, se eliminan sus roles)
Usuario *-- Estudiante
Usuario *-- Apoderado
Usuario *-- Docente

' Asociación many-to-many con clase asociativa
Usuario -- UsuarioRol
Rol -- UsuarioRol

' Asociación many-to-many con clase asociativa
Estudiante -- EstudianteApoderado
Apoderado -- EstudianteApoderado

' Agregación: IE agrupa Usuarios y Estudiantes
Ie o-- Usuario
Ie o-- Estudiante

' Asociación: GradoSeccion contiene Estudiantes
GradoSeccion -- Estudiante

' ============================================
' RELACIONES: HORARIOS
' ============================================
' Composición: GradoSeccion contiene HorarioClase
GradoSeccion *-- HorarioClase

' Asociación: Docente imparte HorarioClase
Docente -- HorarioClase

' Dependencia: HorarioClase usa TipoActividadEnum
HorarioClase ..> TipoActividadEnum

' Asociación many-to-many con clase asociativa
Docente -- DocenteAula
GradoSeccion -- DocenteAula

' Asociación: DocenteAula clasificado por TipoAsignacion
TipoAsignacion -- DocenteAula

' ============================================
' RELACIONES: ASISTENCIAS
' ============================================
' Composición: Estudiante contiene sus Asistencias
Estudiante *-- Asistencia
Estudiante *-- AsistenciaIE

' Asociación: HorarioClase registra Asistencias
HorarioClase -- Asistencia

' Asociación: EstadoAsistencia clasifica Asistencias
EstadoAsistencia -- Asistencia

' Asociación: Usuario registra Asistencias
Usuario -- Asistencia

' Agregación: IE agrupa AsistenciasIE
Ie o-- AsistenciaIE

' Composición: Asistencia contiene su Histórico
Asistencia *-- HistoricoEstadoAsistencia

' Asociación: EstadoAsistencia y Usuario en Histórico
EstadoAsistencia -- HistoricoEstadoAsistencia
Usuario -- HistoricoEstadoAsistencia

' ============================================
' RELACIONES: JUSTIFICACIONES
' ============================================
' Composición: Estudiante contiene sus Justificaciones
Estudiante *-- Justificacion

' Agregación: IE agrupa Justificaciones
Ie o-- Justificacion

' Asociación: Clasificadores de Justificacion
TipoJustificacion -- Justificacion
EstadoJustificacion -- Justificacion
EstadoAsistencia -- Justificacion

' Asociación: Usuarios presentan y revisan
Usuario -- Justificacion

' Composición: Justificacion contiene Documentos
Justificacion *-- DocumentoJustificacion

' Asociación: Usuario sube documentos
Usuario -- DocumentoJustificacion

' Asociación many-to-many con clase asociativa
Asistencia -- AsistenciaJustificacion
Justificacion -- AsistenciaJustificacion

' Asociación: Usuario aplica justificaciones
Usuario -- AsistenciaJustificacion

' ============================================
' RELACIONES: RETIROS
' ============================================
' Composición: Estudiante contiene sus Retiros
Estudiante *-- Retiro

' Agregación: IE agrupa Retiros
Ie o-- Retiro

' Asociación: GradoSeccion registra Retiros
GradoSeccion -- Retiro

' Asociación: Clasificadores de Retiro
TipoRetiro -- Retiro
EstadoRetiro -- Retiro

' Asociación: Actores en el proceso de Retiro
Docente -- Retiro
Apoderado -- Retiro
Usuario -- Retiro

' Asociación many-to-many con clase asociativa
Estudiante -- AutorizacionRetiro
Apoderado -- AutorizacionRetiro

' ============================================
' RELACIONES: NOTIFICACIONES Y REUNIONES
' ============================================
' Composición: Usuario contiene sus Notificaciones
Usuario *-- Notificacion

' Composición: IE contiene sus Reuniones
Ie *-- Reunion

' Asociación many-to-many: Reunion convoca Grados y Secciones
Reunion -- Grado
Reunion -- Seccion

' Dependencia: Reunion usa TipoReunionEnum
Reunion ..> TipoReunionEnum

@enduml
